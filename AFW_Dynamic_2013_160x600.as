package {	import com.ScrollBar;	import com.Utils;	import com.greensock.TweenLite;	import com.greensock.easing.Quad;		import flash.display.MovieClip;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.net.URLLoader;	import flash.text.*;		import pointroll.getFlashVar;	import pointroll.initAd;	import pointroll.launchURL;	import pointroll.info.getFolderPath;		[SWF(width="160", height="600",frameRate="30", backgroundColor="#FFFFFF")]	public class AFW_Dynamic_2013_160x600 extends MovieClip	{			private var _dynamicMC:MovieClip;		private var _adSize:String;		private var _scrollBar:MovieClip = new MovieClip();		private var _scrollContentMC:MovieClip = new MovieClip();		private var _contentMC:MovieClip = new MovieClip();		private var _zipCode:String;		private var _footer:MovieClip		private var _dataLoader:URLLoader = new URLLoader;		private var _data:XMLList;		private var _progressIndicatorMC:ProgressIndicatorMC;		private var _rowColor:uint = 0xE7F4FD //0xF5FBFF;		private var _urlAR:Array;				public function AFW_Dynamic_2013_160x600()		{			this.addEventListener(Event.ADDED_TO_STAGE, initialize);					}				private function initialize(e:Event):void		{			pointroll.initAd(this);							this._zipCode = pointroll.getFlashVar("zipCode")||"19401";			Utils.listFonts()			this._adSize = pointroll.getFlashVar("adSize")||"160x600";			this._dataLoader.addEventListener(Event.COMPLETE,this._dataRecieved);						Utils.addClip(this, _dynamicMC, Utils.rect(0, 0, 160, 600, 1, 0xD7E3FF, 0, [0xFFFFFF, 0xCBEAFF], [1, 1], [0, 255], 90), "clickTag1", 0, 0, 1, null, true, MouseEvent.CLICK, this._generalClick, "button");						Utils.addClip(this,_dynamicMC,Utils.newImage(pointroll.info.getFolderPath()+"clouds1.png"),"clouds1",-20,10,.2);			Utils.addClip(this,_dynamicMC,Utils.newImage(pointroll.info.getFolderPath()+"clouds2.png"),"clouds2",-200,40,.2);			Utils.addClip(this,_dynamicMC,Utils.newImage(pointroll.info.getFolderPath()+"clouds3.png"),"clouds3",-10,350,.2);			Utils.addClip(this,_dynamicMC,Utils.newImage(pointroll.info.getFolderPath()+"clouds4.png"),"clouds4",-40,300,.2);			Utils.addClip(this,_dynamicMC,Utils.newImage(pointroll.info.getFolderPath()+"AFW_header_160v2.jpg"),"header",0,-105);			this.addEventListener("footer", this._setFooter);						Utils.addClip(this, this._dynamicMC, Utils.rect(0, 0, 160, 167, 1, 0xF6FBFF, 0, null, null, null, 0, [.25, 0xC4E4fE]), "footer", 0, 600, 1, null, true);						this.addEventListener("plane",this._flyPlane);			Utils.addClip(this,_dynamicMC,Utils.newImage(pointroll.info.getFolderPath()+"paperplane.png"),"plane",-300,140);			//Utils.addClip(this, _dynamicMC, Utils.rect(0, 0, 159, 599, 1, 0xFFFFFF, 0, [0, 0], [0, 0], [0, 0], 0, [.25, 0x1A2E6D]));						this._scrollContentMC.alpha = 0;			this._scrollContentMC.visible = false;			this._scrollBar.x = 291;			this._scrollContentMC.y = 100;			this.addChild(this._scrollContentMC);			this._scrollContentMC.addChild(this._contentMC);			this._scrollContentMC.addChild(this._scrollBar);			this.addEventListener("progressIndicator",this._setProgressIndicator);			Utils.addClip(this,_dynamicMC,ProgressIndicatorMC,"progressIndicator",80,260,1);						this._scrollContentMC.addEventListener("contentMask",this._setScrollbar);			Utils.addClip(this._scrollContentMC, _dynamicMC, Utils.rect(0, 0, 160, 600, 1, 0xFF0000), "contentMask", 0, 0, 1);				//BORDER 					Utils.addClip(this,_dynamicMC,Utils.rect(0,0,159,599,1,0xFFFFFF,0,[0,0],[0,0],[0,0],0,[.25,0x1A2E6D]));		}				private function _setProgressIndicator(e:Event):void		{			this._progressIndicatorMC = ProgressIndicatorMC(e.target.getChildByName(e.type));			this._progressIndicatorMC.visible = false;			this._progressIndicatorMC.scaleX = this._progressIndicatorMC.scaleY = 2;					}				private function _setScrollbar(e:Event):void		{			//Utils.addClip(this._scrollBar,_dynamicMC,Utils.rect(0,0,8,136,1,0x000000),"trackBG",0,0,1,null,true);						//Utils.addClip(this._scrollBar,_dynamicMC,Utils.rect(0,0,8,136,1,0xCCCCCC),"trackMC",0,0,1,null,true);						//Utils.addClip(this._scrollBar,_dynamicMC,Utils.rect(0,0,8,30,1,0x666666),"draggerMC",0,0,1,null,true);						//Utils.addClip(this._scrollBar,_dynamicMC,Utils.triangle(7,null,0x999999,7,-90),"upBT",4,-5,0,null,true);						//Utils.addClip(this._scrollBar,_dynamicMC,Utils.triangle(7,null,0x999999,7,90),"downBT",4,140,0,null,true);						this._contentMC.mask = this._scrollContentMC.getChildByName("contentMask");			//ScrollBar.setScrollBar(this._scrollBar);			//this._scrollBar.addEventListener("scrub",this._scrollContent);				//this._scrollBar.addEventListener("SCRUB_DOWN",this._trackScroll);		}				private function _trackScroll(e:Event=null):void		{			pointroll.trackActivityOnce(2);		}				private function _scrollContent(e:Event=null):void		{			var yPos:Number = (this._scrollContentMC.getChildByName("contentMask").height) - (this._contentMC.height*ScrollBar.ratio);			if(yPos > 0)yPos = 0;						var maxScroll:Number = this._scrollContentMC.getChildByName("contentMask").height-this._contentMC.height			if(yPos < maxScroll)yPos = maxScroll;						if(yPos <= 8)TweenLite.to(this._contentMC,.5,{y:yPos});		}						private function _setFooter(e:Event):void		{				this._footer = MovieClip(this.getChildByName(e.type))			this._footer.addEventListener("clickTag3", Utils.addMouseOverEvents);			Utils.addClip(this._footer,this._dynamicMC,Utils.rect(0,0,135,30,1,0x159DD3,15,[0xFEE0AE,0xFFC15D],[1,1],[0,255],90,[1,0xFFA74B],"clickTag3"),"clickTag3",12,50,1,null,true,MouseEvent.CLICK,this._ctaClick,"button",0,null,"Find Fares",[0,0,135,30,1,0x159DD3,15,[0xFFFFCC,0xFFE180],[1,1],[0,255],90,[1,0xFFC15D]],0x18357E,14,false,"Verdana","left",145,false,2,20);			//Utils.addClip(this._footer,this._dynamicMC,Utils.rect(0,0,160,20,1,0xFFFFFF,0,null,null,null,0,[1,0x777777]),"entryBG",10,10,1);			//Utils.addClip(this._footer,this._dynamicMC,Utils.newEntryField(160,"enter a departure city",1000,22),"entryField",12,10,1,null,true,MouseEvent.CLICK,this._selectEntryText);			Utils.addClip(this._footer,_dynamicMC,Utils.triangle(10,null,0x18357E,6),"tri",125,66,1);		}				private function _selectEntryText(e:MouseEvent):void		{			pointroll.trackActivity(1);			e.target.setSelection(0,e.target.length);			}				private function _flyPlane(e:Event):void		{ 			TweenLite.to(this.getChildByName("clouds1"),3,{x:"-60",ease:Quad.easeOut});			TweenLite.to(this.getChildByName("clouds2"),3,{x:"-50",ease:Quad.easeOut});			TweenLite.to(this.getChildByName("clouds3"),3,{x:"-40",ease:Quad.easeOut});			TweenLite.to(this.getChildByName("clouds4"),3,{x:"-55",ease:Quad.easeOut});			TweenLite.to(this.getChildByName("plane"),3,{x:300,y:-10,ease:Quad.easeOut});			TweenLite.to(this.getChildByName("header"),.5,{delay:3,y:0,ease:Quad.easeOut});			TweenLite.to(this.getChildByName("footer"), .5, { delay:2.5, y:464, ease:Quad.easeOut, onComplete:this._search } );									if (root.loaderInfo.url.indexOf("file") == 0) {				trace("\n  LOCAL TESTING  ######################## : "  )				//_search();			}		}				private function _search(e:Event=null):void		{			if(e!=null)this._zipCode = TextField(MovieClip(this._footer.getChildByName("entryField")).getChildByName("inputTF")).text			Utils.getData("http://cgizmo.pointroll.com/api/data/36?_format=xml&take=20&zip="+this._zipCode,this._dataLoader);						if (root.loaderInfo.url.indexOf("file")!= 0) {				trace("\n  LOCAL TESTING  ######################## : "  )				while (this._contentMC.numChildren > 0) this._contentMC.removeChildAt(0); 							}						this._progressIndicatorMC.visible = true;			this._scrollContentMC.visible = false;		}				private function _dataRecieved(_data:*):void		{			for(var i:int=1;i<5;i++)this.getChildByName("clouds"+i).visible = false;			this._progressIndicatorMC.visible = false;			//trace(this._data)			this._data = Utils.shuffleXMLList(XMLList(this._dataLoader.data).children());			//this._data = this._data.children();			this._urlAR = new Array();			var yPos:int = 0;			var id:int = 1;			 			//var boldFont:Font = new Font1();			//trace("\n ############ boldFont.fontName: " + boldFont.fontName);						for (var j:int=0;j<7;j++)			{					var record:XML = this._data.data[j];				//trace("\n record: " + record)				var nameSTR:String = String(id);				//trace("\n nameSTR: " + nameSTR)				this._urlAR.push(record.AWDURL)				//this._contentMC.addEventListener(nameSTR,this._setPriceFormat);								this._contentMC.addEventListener(nameSTR, Utils.addMouseOverEvents);		 				//Utils.addClip(this._contentMC,this._dynamicMC,Utils.rect(0,0,158,52,1,this._rowColor,0,null,null,null,0,null,nameSTR),nameSTR,1,yPos,1,null,true,MouseEvent.CLICK,this._launchLink,"button",0,null,"$"+int(record.Price)+" RT",[0,0,158,52,1,0xFFE180],0x135ED5,8,true, new Font1().fontName ,"left",100,false,-8,1,0); 				//Utils.addClip(this._contentMC,this._dynamicMC,Utils.rect(0,0,158,52,1,this._rowColor,0,null,null,null,0,null,nameSTR),nameSTR,1,yPos,1,null,true,MouseEvent.CLICK,this._launchLink,"button",0,null,"$"+int(record.Price)+" RT",[0,0,158,52,1,0xFFE180],0x135ED5,8,true,"Verdana","left",100,false,-8,1,0);								var rowHeight:uint = 52;								Utils.addClip(this._contentMC, this._dynamicMC,								Utils.rect( -120, 0, 180, rowHeight, 1,								this._rowColor, 0, null, null, null, 0, null, nameSTR),								nameSTR, 110, yPos, 1, null, true, MouseEvent.CLICK,								this._launchLink, "button", 0, null,								"$" + int(record.Price) + " RT",								[-120, 0, 188, rowHeight, 1, 0xFFE180],								0x135ED5, 8, true, "Verdana", "left", 100, false, -12, 1, 0);								 				//Utils.addClip(this._contentMC, this._dynamicMC, Utils.rect(0, 0, 1, 1, 600, 0x00CCFF), "line", 45, yPos, .3);							//HORIZONTAL CITY SEPERATOR				//Utils.addClip(this._contentMC, this._dynamicMC, Utils.rect(0, 0, 94, 1, 1, 0x00CCFF), "line", 5, yPos + 26, .3);							//VERTICAL SEPERATOR				//Utils.addClip(this._contentMC,this._dynamicMC,Utils.rect(0,0,1,36,1,0x00CCFF),"line",85,yPos,.3);				Utils.addClip(this._contentMC, this._dynamicMC, Utils.rect(0, 0, 1, rowHeight, 1, 0x00CCFF), "line", 108, yPos, .3);												this._contentMC.addEventListener("origin" + nameSTR, this._checkTxtSize); 				this._contentMC.addEventListener("dest" + nameSTR, this._checkTxtSize);																Utils.addClip(this._contentMC, this._dynamicMC, Utils.newTextField(100, TextFieldAutoSize.LEFT, true, String(record.OriginText).substr(0, record.DestinationText.length - 6) , 								"Verdana", 9, true, 0x135ED5, false, "tf", "left", -2, false, -.2),								"origin" + nameSTR, 7, yPos+5);								Utils.addClip(this._contentMC, this._dynamicMC, Utils.newTextField(100, TextFieldAutoSize.LEFT, true, "TO", 								"Verdana", 9, true, 0x135ED5, false, "tf", "left", -2, false, -.2),								"origin" + nameSTR, 9, yPos + 20);								Utils.addClip(this._contentMC, this._dynamicMC, Utils.newTextField(100, TextFieldAutoSize.LEFT, true, String(record.DestinationText).substr(0, record.DestinationText.length - 6),								"Verdana", 9, true, 0x135ED5, false, "tf", "left", -2, false, -.2),								"dest" + nameSTR, 7, yPos + 35);																								Utils.addClip(this._contentMC, this._dynamicMC, Utils.newTextField(50, TextFieldAutoSize.LEFT, true, "Fare Details", "Verdana", 9, true, 0x135ED5, true, "tf", "left", 0, false, -.2), "dt", 112, yPos + 22);												//Utils.addClip(this._contentMC,this._dynamicMC,Utils.shape([[0,0],[5,0],[7,2],[5,4],[0,4],[2,2],[0,0]],null,0x888888),"dt",140,yPos+52);							if(this._rowColor != 0xE7F4FD)this._rowColor = 0xE7F4FD;				else this._rowColor = 0xF5FBFF;				yPos += 52;								id ++;							}			Utils.addClip(this,_dynamicMC,Utils.rect(0,0,159,599,1,0xFFFFFF,0,[0,0],[0,0],[0,0],0,[.25,0x1A2E6D]));			this._scrollContentMC.visible = true;			TweenLite.to(this._scrollContentMC,.5,{alpha:1,ease:Quad.easeOut});					}				private function _checkTxtSize(e:Event=null):void		{			var textMC:MovieClip = MovieClip(e.target.getChildByName(e.type));			var textTF:TextField = TextField(textMC.getChildByName("textTF"));			var txSize:int = 9			while(textTF.textHeight>26)			{				trace(txSize)				Utils.formatText(textTF,false,"Verdana",0x135ED5,false,txSize,-.2,0,"left",textTF.text);				txSize--;			}		}				private function _launchLink(e:MouseEvent):void		{			var urlID:int = int(e.target.parent.name)-1;			pointroll.launchURL(pointroll.getFlashVar("clickTag2")+this._urlAR[urlID])		}		private function _setPriceFormat(e:Event=null):void		{			var textMC:MovieClip = MovieClip(MovieClip(e.target.getChildByName(e.type)).getChildAt(2));			var textTF:TextField = TextField(textMC.getChildByName("textTF"));			Utils.formatText(textTF,true,"Verdana",0x135ED5,false,7,-.2,0,"center","RT");		}		private function _ctaClick(e:Event):void		{			trace("clickTag3")			pointroll.launchURL(pointroll.getFlashVar("clickTag3"));		}		private function _generalClick(e:Event):void		{			trace("clickTag1")			pointroll.launchURL(pointroll.getFlashVar("clickTag1"));		}			}}